---
sidebar_label: Manifest Reference
title: Manifest Reference
description: Reference for the manifest DSL
---

# Manifest language reference

This topic documents v3 of the Topaz manifest language.

## Annotated reference

```yaml
# yaml-language-server: $schema=https://www.topaz.sh/schema/manifest.json
---

# Declares the version of the model
# Supported value: 3
model:
  version: 3

## Declare object types
types:

  # Declare the "user" object type
  # The annotation "display_name" acts as a hint to the Topaz UI for a display name for this type
  ### display_name: User ###
  user:
    # Declare relations that are supported by the user object type
    # The declaration below means that the target of the "manager" relation
    #   can only be an instance of a "user".
    relations:
      manager: user

  # Declare the "group" object type
  group:
    # Declare relations that are supported by this object type
    # Format: <relation_name>: <type> | <another_type> | <type#relation>
    relations:
      # The declaration below means that the target of the "member"
      #   relation can be of type "user" OR the set of objects defined
      #   by relation "group#member".
      member: user | group#member

  # Declare the "folder" object type
  folder:
    # Declare relations that are supported on "folder"
    relations:
      # The "parent" relation defines a recursive parent relationship
      parent: folder
      owner: user | group#member
      editor: user | group#member
      viewer: user | group#member

    # Declare permissions that are supported on "folder"
    permissions:
      # Format: <permission_name>: relation1 | relation2 | type->permission
      # The declaration below means that the "can_read_folder" permission
      #   is granted by the viewer OR editor OR owner relation, OR through
      #   a relation to the parent folder that carries the "can_read_folder"
      #   permission.
      can_read_folder: viewer | editor | owner | parent->can_read_folder
      can_write_folder: editor | owner | parent->can_write_folder
      can_delete_folder: owner | parent->can_delete_folder

  # Declare the "document" object type
  document:
    relations:
      parent: folder
      owner: user | group#member
      editor: user | group#member
      viewer: user | group#member

    permissions:
      can_read_document: viewer | editor | owner | parent->can_read_folder
      can_write_document: editor | owner | parent->can_write_folder
      can_delete_document: owner | parent->can_delete_folder
```

## Operators

Topaz supports four operators for defining how permissions are granted through relations.

### Union

The Union operator (`|`) indicates that a permission is granted through ANY of the listed relations.

Example:

```yaml
  can_read: viewer | editor | owner
```

This means that the `can_read` permission is granted through the `viewer` OR `editor` OR `owner` relations.

### Intersection

The Intersection operator (`&`) indicates that a permission is granted only if the target is part of ALL the listed relations.

Example:

```yaml
  can_comment: viewer & commenter
```

This means that the `can_comment` permission is granted only if the user is the subject of the `viewer` relation, AND is also the subject of the `commenter` relation.

### Exclusion

The Exclusion operator (`-`) indicates that a permission is granted only if the target is NOT part of the listed relation.

Example:

```yaml
  can_comment: commenter - guest
```

This means that the `can_comment` permission is granted to subjects that are commenters and are NOT guests.

### Arrow

The Arrow operator (`->`) allows specifying subjects of a permission or relation that is defined on another type.

Example:

```yaml
  types:
    folder:
      relations:
        parent: folder
        owner: user | group#member
      permissions:
        can_delete_folder: owner | parent->can_delete_folder
    document:
      relations:
        parent: folder
        owner: user | group#member
      permissions:
        can_delete_document: owner | parent->can_delete_folder
```

In the above example, `document` and `folder` types both have a `parent` relation which is of type `folder`.

The `can_delete_folder` permission can be granted by assigning a subject directly as the `owner` of a `folder`, OR if that subject is an `owner` of a `folder` in the `parent` relation chain.

Likewise, the `can_delete_document` permission can be granted by assigning a subject directly as the `owner` of a `document`, OR if that subject has a `can_delete_folder` permission on a  `folder` in the `parent` relation chain.

Arrow operators are integral to defining hierarchical permissions.
